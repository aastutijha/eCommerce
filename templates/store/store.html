{% extends 'store/main.html' %} {% load static %} {% block content %}
<div class="row">
  {% for product in products %}
  <div class="col-lg-4">
    <img class="thumbnail" src="{{ product.imageURL }}" />
    <div class="box-element product">
      <h6><strong>{{ product.name }}</strong></h6>
      <hr />
      <button
        data-product="{{"
        product.id
        }}
        data-action="add"
        class="btn btn-outline-secondary add-btn update-cart"
      >
        Add to Cart
      </button>
      <a class="btn btn-outline-primary" href="#">View</a>
      <h4 style="display: inline-block; float: right">
        <strong>${{ product.price|floatformat:2 }} </strong>
      </h4>
    </div>
  </div>
  {% endfor product in products %}
</div>
{% endblock content %} {% block js %}
<script>
  var updateBtns = document.getElementsByClassName("update-cart");

  for (i = 0; i < updateBtns.length; i++) {
    updateBtns[i].addEventListener("click", function () {
      var productId = this.dataset.product;
      var action = this.dataset.action;
      console.log("productId:", productId, "Action:", action);

      console.log("USER:", user);
      if (user == "AnonymousUser") {
        console.log("Not logged in");
      } else {
        updateUserOrder(productId, action);
      }
    });
  }

  function updateUserOrder(productId, action) {
    console.log("User is logged in, sending data...");

    var url = "/update_item/";

    fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken,
      },
      body: JSON.stringify({ productId: productId, action: action }),
    })
      .then((response) => {
        return response.json();
      })

      .then((data) => {
        console.log("data:", data);
      });
  }
</script>
{% endblock js %}
